<div class="col-md-12 no-padding">
  <!--- LEFT SIDE PAGE -->
  <div class="col-md-4 no-padding" <% if !mobile_device? %> data-spy="affix" <% end %> style="<% if !mobile_device? %> width:30%<% end %>">
   <div class="input-group">
     <span class="input-group-addon"><i class="fa fa-search"></i></span>
     <input id='events_table_search' type="search" class="form-control" placeholder="Search...">
     <% if ((can? :manage, :all) || (can? :update, @event, :context => :admin))%>
      <span class="input-group-addon bg-color-green">
      <%= link_to('New Event'.html_safe, {:controller => 'Admin::Events' ,:action => 'new'}) %>
      </span>
     <% end %>
   </div>
   <br>
   <div class="well">
    <div class="row">
      <h3 class="no-padding text-center">Filters</h3>
      <div class="col-md-6">
        <%= select_tag "organization", options_from_collection_for_select(Organization.all, "id", "name"), prompt: "Select Organization", :class => "form-control", :id=>"organization_filter" %>
      </div>
      <div class="col-md-6">
        <%= select_tag "building", options_from_collection_for_select(Location.all, "id", "building_name"), prompt: "Select Location", :class => "form-control", :id=>"building_filter" %>
      </div>
    </div>
   </div>
  <br>
  <div class="jarviswidget">
    <div>
      <div class="widget-body no-padding">
         <div class="widget-body-toolbar">
            <div id="calendar-buttons">
             <div class="btn-group">
                <a href="javascript:void(0)" class="btn btn-default btn-xs" id="btn-prev"><i class="fa fa-chevron-left"></i></a>
                <a href="javascript:void(0)" class="btn btn-default btn-xs" id="btn-next"><i class="fa fa-chevron-right"></i></a>
                <div class="btn-group">
                  <button class="calmenu btn dropdown-toggle btn-xs btn-default" data-toggle="dropdown">Showing <i class="fa fa-caret-down"></i>
                  </button>
                  <ul class="dropdown-menu js-status-update pull-right">
                     <li>
                        <a href="javascript:void(0);" id="mt">Month</a>
                     </li>
                     <li>
                        <a href="javascript:void(0);" id="ag">Agenda</a>
                     </li>
                     <li>
                        <a href="javascript:void(0);" id="td">Today</a>
                     </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
          <div id="calendar"></div>
        </div>
      </div>
    </div>
  </div>
   <!--- RIGHT SIDE PAGE -->
  <div class="col-md-8 <% if !mobile_device? %> col-md-offset-4 <% end %> ">
   <div class="col-md-12 no-padding" id='events_grid'></div>
   <table summary "Events List" id="events_table" style="display: none"class="table table-hover"  data-source="<%= root_path(format: "json") %>"></table>
  </div>
</div>










<% content_for :scripts do %>
<script type="text/javascript">
   var datatable;
   $( document ).ready(function() {
     pageSetUp();
     var events_table = $('#events_table').dataTable({
       "sDom": "<'row'<'col-lg-12'>r>t<'row'<'col-lg-12 col-md-12'><'col-lg-7 col-md-7 center'p>>",
       "sPaginationType": "simple",
       "iDisplayLength": 6,
       "bProcessing": true,
       "bServerSide": true,
       "oLanguage": {
        "sProcessing": "<div class='centerProcessing shaft-load3'><div class='shaft1'></div><div class='shaft2'></div><div class='shaft3'></div><div class='shaft4'></div><div class='shaft5'></div><div class='shaft6'></div><div class='shaft7'></div><div class='shaft8'></div><div class='shaft9'></div> <div class='shaft10'></div></div>"
           },
       "sAjaxSource": $('#events_table').data('source'),
       "aaSorting": [[ 0, "desc" ]],
        "columns": [
         { "title": "Square Setup", "data": "events_eventTile"}
       ],
       fnServerParams: function ( aoData ) {
         aoData.push(
           { "name": "sSearch", "value": $("#events_table_search").val() },
           { "name": "iDisplayLength", "value": $("#events_table_length").val() },
           { "name": "orgFilter", "value": $("#organization_filter").val() },
           { "name": "locFilter", "value": $("#building_filter").val() }
         );
       },
       fnDrawCallback: function( oSettings ) {
         $('#events_grid').html('');
         $.each(oSettings.aoData, function( index, result ) {
           $('#events_grid').append(result._aData.events_eventTile);
         });
     }
   });
     $("#organization_filter").change(function() {
      events_table.dataTable().api().draw(true);
      });
     $("#building_filter").change(function() {
      events_table.dataTable().api().draw(true);
      });
     $('#events_table_search').keyup(function(){
       events_table.dataTable().api().draw(true);
     });


     var hdr = {left: 'title',
               center: 'month,agendaWeek,agendaDay',
               right: 'prev,today,next'
         };
         $('#calendar').fullCalendar({
             header: hdr,
             buttonIcons: {
                 prev: 'left-single-arrow',
                 next: 'right-single-arrow'
             },
           timezone: 'local',
               windowResize: function (event, ui) {
                 $('#calendar').fullCalendar('render');
             },

       eventSources: [
       {
           url: '/cal_events.json',
           type: 'GET',
           error: function() {
               alert('there was an error while fetching events!');
           }
       }
   ],
       eventClick: function(event) {
       if (event.url) {
           window.open(event.url);
           return false;
       }
   }
         });

         /* hide default buttons */
         $('.fc-header-right, .fc-header-center').hide();


       $('#calendar-buttons #btn-prev').click(function () {
           $('.fc-button-prev').click();
           return false;
       });

       $('#calendar-buttons #btn-next').click(function () {
           $('.fc-button-next').click();
           return false;
       });

       $('#calendar-buttons #btn-today').click(function () {
           $('.fc-button-today').click();
           return false;
       });

       $('#mt').click(function () {
           $('#calendar').fullCalendar('changeView', 'month');
       });

       $('#ag').click(function () {
           $('#calendar').fullCalendar('changeView', 'agendaWeek');
       });

       $('#td').click(function () {
           $('#calendar').fullCalendar('changeView', 'agendaDay');
       });
      $('#events_table_processing').addClass('affix')
   })
       setTimeout(function(){
           $('#flash').remove();
       }, 5000);

</script>
<% end %>
<style>


.centerProcessing{
  margin-top: 15%;
  margin-left: 28%;
  z-index:500;
  position: fixed !important;
}

div.dataTables_processing
  {
    background:none;
    /*background-color: rgba(255,255,255,.7);*/
    color: white;
    top: 50%;
    left: 50%;
    position: relative;
    padding-top:0px !important;
    width: 100%;
    height: 500px !important;
    margin-left: -50%;
    margin-top: -25px;
    padding-top: 20px;
    padding-bottom: 20px;
    text-align: center;
    font-size: 2.2em;
}



#myTab{
  border:none;
}
#myTabContent1{
  border:none;
}
#myTabContent2{
  border:none;
}
.progress {
    position: relative;
  height: 25px;
}
.progress > .progress-type {
  position: absolute;
  left: 0px;
  font-weight: 800;
  padding: 3px 30px 2px 10px;
  color: rgb(255, 255, 255);
  background-color: rgba(25, 25, 25, 0.2);
}
.progress > .progress-completed {
  position: absolute;
  right: 0px;
  font-weight: 800;
  padding: 3px 10px 2px;
}


#events_table_paginate{
  margin:auto;

}
   #events_table_processing
   {
   }
   .fc-left{
   margin-top: -20px;
   margin-left: 10px;
   }
</style>

